#!/usr/bin/env python3
"""
CLI entry point for ValRep workflow.

This script loads configuration, parses CLI arguments, and calls
``run_workflow`` to execute the analysis pipeline.
"""

from __future__ import absolute_import
import sys
import os
import argparse

# Add valrep package path
# (Ensures local project modules can be imported)
root_path = os.path.abspath(os.path.join(os.path.dirname(__file__), ".."))
sys.path.insert(0, root_path)

from valrep.runner import run_workflow

# -------------------------------
# CLI arguments
# -------------------------------
parser = argparse.ArgumentParser(
    description="ValRep workflow manager"
)

# Path to configuration file
parser.add_argument(
    "--config",
    required=True,
    help="Path to config file (JSON/YAML)"
)

# Run only a single step
parser.add_argument(
    "--step",
    help="Run a single step"
)

# Run a comma-separated list of steps
parser.add_argument(
    "--steps",
    help="Comma-separated steps"
)

# Working directory for outputs
parser.add_argument(
    "--workdir",
    default="./all_points_runs",
    help="Directory to store outputs"
)

args = parser.parse_args()

# Determine steps override
# (Ensures mutual exclusivity of --step and --steps)
if args.step:
    steps_override = [args.step.lower()]
elif args.steps:
    steps_override = [s.strip().lower() for s in args.steps.split(",")]
else:
    steps_override = None

# Run workflow
# Calls the main workflow manager with parsed arguments
run_workflow(
    config_path=args.config,
    steps_override=steps_override,
    workdir=args.workdir
)
